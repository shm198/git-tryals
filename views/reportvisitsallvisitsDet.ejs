<% include partials/adminheader.ejs %>
    <h1 class="formheading mb-2">REPORTS - ALL VISITS (For Database export) <a href="/reports/visits/allvisits/exportcsv" class="head-right">Export CSV</a></h1>
    <table class="table table-warning">
        <thead class="table-primary">
          <tr>
            <th scope="col">Subject Name</th>
            <th scope="col">Subject DOB</th>
            <th scope="col">Subject Address</th>
            <th scope="col">Subject City</th>
            <th scope="col">Subject Province</th>
            <th scope="col">Subject Zip</th>
            <th scope="col">Subject Country</th>
            <th scope="col">Visit Date</th>
            <th scope="col">Study Short Name</th>
            <th scope="col">Study Name</th>
            <th scope="col">Site Short Name</th>
            <th scope="col">Site Name</th>
            <th scope="col">Phase Number</th>
        <% visitfields.forEach(function(field){ %>
            <th scope="col"><%= field.fieldname %></th>
        <% }); %>
          </tr>
        </thead>
        <tbody>
            <% visits.forEach(function(visit){ %>
            <tr>
                <td><%= visit.Subject.Subject_Name %></td>
                <td><%= visit.Subject.Subject_DOB %></td>
                <td><%= visit.Subject.Subject_Address %></td>
                <td><%= visit.Subject.Subject_City %></td>
                <td><%= visit.Subject.Subject_Prov %></td>
                <td><%= visit.Subject.Subject_zip %></td>
                <td><%= visit.Subject.Subject_Country %></td>
                <td><%= visit.Visit_date %></th>
                <td><%= visit.Study.Study_short_name %></td>
                <td><%= visit.Study.Study_name %></td>
                <td><%= visit.Site.Site_Short_name %></td>
                <td><%= visit.Site.Site_name %></td>
                <td><%= visit.Phase.Phase_number %></td>
                <% visitfields.forEach(function(field){ %>
                    <% if (visit[field.fieldname]) { %> 
                        <% if (typeof(visit[field.fieldname]) === 'object') { %>
                        <td>
                            <%= Object.values(visit[field.fieldname]) %>
                        </td>
                        <% } else { %>
                        <td>
                            <%= visit[field.fieldname] %>
                        
                        <% } %>
                    <% } else { %>
                        <td></td>
                    <% } %>
                <% }); %>
            </tr>
            <% }); %>
        </tbody>
    </table>
    <hr class="listhr">
<% include partials/adminfooter.ejs %>